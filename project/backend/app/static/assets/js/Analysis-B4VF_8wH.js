import{e as m,m as f,l as P,c as d,o as c,a as t,w as $,v as b,t as a,F as w,r as k,n as _,j as x,b as g}from"./index-C46-3ziS.js";import{_ as p}from"./Logo-DSjxPm7K.js";import{u as V}from"./Main-NPJ5-Wiz.js";import"./index-BtuGy7By.js";const Z={class:"video-panel"},C={class:"video-wrapper"},I={class:"video-frame"},E=["src"],A={class:"video-controls"},q=["max"],z={class:"time-display"},D={__name:"FramePanel",setup(s){m(!1);const e=m(0),n=m({list:[],total:1,fps:30}),u=f(()=>n.value.list[e.value]||"");return P(async()=>{try{const o=await fetch("/api/frames"),{total:l,prefix:r,files:h,fps:S}=await o.json(),T=v=>{v.forEach(F=>new Image().src=F)},y=h.map(v=>`${r}${v}`);T(y),n.value={list:y,total:Math.max(l,1),fps:Math.max(S,1)},e.value=0}catch(o){console.error("帧加载失败:",o)}}),(o,l)=>(c(),d("div",Z,[t("div",C,[l[1]||(l[1]=t("h2",null,"视频帧分析",-1)),t("div",I,[t("img",{src:u.value,alt:""},null,8,E)]),t("div",A,[$(t("input",{type:"range","onUpdate:modelValue":l[0]||(l[0]=r=>e.value=r),min:0,max:n.value.total-1,step:"1",class:"progress-bar"},null,8,q),[[b,e.value,void 0,{number:!0}]]),t("div",z,a(e.value+1)+" / "+a(n.value.total),1)])])]))}},N=p(D,[["__scopeId","data-v-721da987"]]),B={class:"analysis-tabs"},L={class:"tab-nav"},M=["onClick"],R={__name:"AnalysisTabs",setup(s){const e=m("分析报告"),n=m(["分析报告","动作分析","可视化图表"]);return(u,i)=>(c(),d("div",B,[t("div",L,[(c(!0),d(w,null,k(n.value,o=>(c(),d("button",{key:o,class:_({active:e.value===o}),onClick:l=>e.value=o},a(o),11,M))),128))]),i[0]||(i[0]=t("div",{class:"tab-content"},null,-1))]))}},j=p(R,[["__scopeId","data-v-8bda7552"]]),U={props:{type:String,progress:Number,currentTime:Number,duration:Number,isZoomed:Boolean},methods:{formatTime(s){const e=new Date(0);return e.setSeconds(s||0),e.toISOString().slice(11,19)}}},H={class:"video-controls"},O=["value"],G={class:"time-display"};function J(s,e,n,u,i,o){var l;return c(),d("div",H,[t("button",{onClick:e[0]||(e[0]=r=>s.$emit("toggle-play"))},a((l=s.$parent.$refs[`${n.type}Video`])!=null&&l.paused?"▶":"⏸"),1),t("input",{type:"range",class:"progress-bar",value:n.progress,onInput:e[1]||(e[1]=r=>s.$emit("seek",r.target.value)),min:"0",max:"100",step:"0.1"},null,40,O),t("span",G,a(o.formatTime(n.currentTime))+" / "+a(o.formatTime(n.duration)),1),t("button",{onClick:e[2]||(e[2]=r=>s.$emit("toggle-zoom"))},a(n.isZoomed?"✕":"⛶"),1)])}const K=p(U,[["render",J],["__scopeId","data-v-092d2f97"]]),Q={components:{VideoControls:K},props:{originalSrc:String,processedSrc:String},data(){return{isSyncing:!1,progress:{original:0,processed:0},currentTime:{original:0,processed:0},duration:{original:0,processed:0},isZoomed:{original:!1,processed:!1}}},mounted(){document.addEventListener("fullscreenchange",this.handleFullscreenChange)},beforeDestroy(){document.removeEventListener("fullscreenchange",this.handleFullscreenChange)},methods:{togglePlay(s){const e=this.$refs[`${s}Video`];e.paused?e.play():e.pause()},updateProgress(s,e){const n=s.target;this.currentTime[e]=n.currentTime,this.duration[e]=n.duration,this.progress[e]=n.currentTime/n.duration*100||0,this.isSyncing&&e==="original"&&(this.$refs.processedVideo.currentTime=n.currentTime)},handleSeek(s,e){const n=this.$refs[`${e}Video`];n.currentTime=s*n.duration/100},toggleSync(){this.isSyncing=!this.isSyncing,this.isSyncing&&this.syncVideos()},async syncVideos(){await Promise.all([this.$refs.originalVideo.play(),this.$refs.processedVideo.play()])},handlePlay(){this.isSyncing&&this.syncVideos()},handlePause(){this.isSyncing&&(this.$refs.originalVideo.pause(),this.$refs.processedVideo.pause())},async toggleZoom(s){const e=this.$refs[`${s}Panel`];this.isZoomed[s]?(await this.exitFullscreen(),this.isZoomed={...this.isZoomed,[s]:!1}):(await this.enterFullscreen(e),this.isZoomed={...this.isZoomed,[s]:!0})},async enterFullscreen(s){if(s.requestFullscreen)return s.requestFullscreen();if(s.webkitRequestFullscreen)return s.webkitRequestFullscreen();if(s.msRequestFullscreen)return s.msRequestFullscreen();console.warn("Fullscreen API is not supported")},async exitFullscreen(){document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()},handleFullscreenChange(){document.fullscreenElement||(this.isZoomed={original:!1,processed:!1})}}},W={class:"video-comparator"},X={class:"global-controls"},Y={class:"comparison-container"},ee={class:"video-wrapper"},se={class:"video-frame"},oe=["src"],ne={class:"video-wrapper"},te={class:"video-frame"},re=["src"];function ie(s,e,n,u,i,o){const l=x("video-controls");return c(),d("div",W,[t("div",X,[e[13]||(e[13]=t("h2",null,"视频分析（原视频 / 处理视频）",-1)),t("button",{class:"sync-button",onClick:e[0]||(e[0]=(...r)=>o.toggleSync&&o.toggleSync(...r))},a(i.isSyncing?"断开同步":"同步播放"),1)]),t("div",Y,[t("div",{class:_(["video-panel",{"fullscreen-mode":i.isZoomed.original}]),ref:"originalPanel"},[t("div",ee,[t("div",se,[t("video",{ref:"originalVideo",src:n.originalSrc,onPlay:e[1]||(e[1]=r=>o.handlePlay("original")),onPause:e[2]||(e[2]=r=>o.handlePause("original")),onTimeupdate:e[3]||(e[3]=r=>o.updateProgress(r,"original"))},null,40,oe)]),g(l,{type:"original",progress:i.progress.original,currentTime:i.currentTime.original,duration:i.duration.original,"is-zoomed":i.isZoomed.original,onTogglePlay:e[4]||(e[4]=r=>o.togglePlay("original")),onSeek:e[5]||(e[5]=r=>o.handleSeek(r,"original")),onToggleZoom:e[6]||(e[6]=r=>o.toggleZoom("original"))},null,8,["progress","currentTime","duration","is-zoomed"])])],2),t("div",{class:_(["video-panel",{"fullscreen-mode":i.isZoomed.processed}]),ref:"processedPanel"},[t("div",ne,[t("div",te,[t("video",{ref:"processedVideo",src:n.processedSrc,onPlay:e[7]||(e[7]=r=>o.handlePlay("processed")),onPause:e[8]||(e[8]=r=>o.handlePause("processed")),onTimeupdate:e[9]||(e[9]=r=>o.updateProgress(r,"processed"))},null,40,re)]),g(l,{type:"processed",progress:i.progress.processed,currentTime:i.currentTime.processed,duration:i.duration.processed,"is-zoomed":i.isZoomed.processed,onTogglePlay:e[10]||(e[10]=r=>o.togglePlay("processed")),onSeek:e[11]||(e[11]=r=>o.handleSeek(r,"processed")),onToggleZoom:e[12]||(e[12]=r=>o.toggleZoom("processed"))},null,8,["progress","currentTime","duration","is-zoomed"])])],2)])])}const le=p(Q,[["render",ie],["__scopeId","data-v-6773acda"]]),ae={class:"analysis-container"},de={class:"section-title"},ce={class:"content-wrapper"},ue={__name:"Analysis",setup(s){const e=V(),n=f(()=>e.historyItems.find(i=>i.id===e.currentAnalysisId)),u=f(()=>n.value?new Date(n.value.time).toLocaleString():"");return(i,o)=>(c(),d("div",ae,[t("h2",de,"分析汇总界面 - "+a(u.value),1),t("div",ce,[g(le),g(N),g(j)])]))}},fe=p(ue,[["__scopeId","data-v-1783c3e8"]]);export{fe as default};
