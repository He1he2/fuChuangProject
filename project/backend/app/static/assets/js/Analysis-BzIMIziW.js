import{u as w,e as v,m as y,H as T,l as x,c as p,o as g,a as n,f as k,t as u,w as Z,v as I,F as C,r as z,n as b,j as A,b as F,p as B}from"./index-CbH_KO00.js";import{_ as S}from"./Logo-XA0RF3xk.js";import{a as E}from"./index-BtuGy7By.js";import{u as q}from"./Main-BnFqnXKd.js";const N={class:"video-panel"},D={class:"video-wrapper"},L={class:"video-frame"},R=["src"],U={key:0,class:"loading-overlay"},j={class:"loading-text"},H={class:"video-controls"},M=["max","disabled"],O={class:"time-display"},G={__name:"FramePanel",props:{videoId:{type:String,required:!0}},setup(o){const e=o,i=w(),m=v([]),r=v(!0),s=v(0),d=v(0),t=y(()=>m.value.length),h=y(()=>d.value+1),P=y(()=>m.value[d.value]||""),_=async a=>{try{r.value=!0;const l=await fetch(`/api/frames-batch/${a}`,{headers:{Authorization:`Bearer ${i.token}`}}),{data:c}=await l.json();if(c!=null&&c.frames)for(let f=0;f<c.frames.length;f+=20)m.value.push(...c.frames.slice(f,f+20)),s.value=m.value.length,await new Promise(V=>setTimeout(V,50))}catch(l){console.error("加载失败:",l)}finally{r.value=!1}};return T(()=>e.videoId,a=>{a&&(m.value=[],_(a))}),x(()=>{e.videoId&&_(e.videoId)}),(a,l)=>(g(),p("div",N,[n("div",D,[l[1]||(l[1]=n("h2",null,"视频帧分析",-1)),n("div",L,[n("img",{src:P.value,alt:""},null,8,R),r.value?(g(),p("div",U,[n("div",j,"加载中... "+u(s.value)+"/"+u(t.value),1)])):k("",!0)]),n("div",H,[Z(n("input",{type:"range","onUpdate:modelValue":l[0]||(l[0]=c=>d.value=c),min:0,max:t.value-1,step:"1",disabled:r.value},null,8,M),[[I,d.value,void 0,{number:!0}]]),n("div",O,u(h.value)+" / "+u(t.value),1)])])]))}},J=S(G,[["__scopeId","data-v-363dce21"]]),K={class:"analysis-tabs"},Q={class:"tab-nav"},W=["onClick"],X={__name:"AnalysisTabs",setup(o){const e=v("分析报告"),i=v(["分析报告","动作分析","可视化图表"]);return(m,r)=>(g(),p("div",K,[n("div",Q,[(g(!0),p(C,null,z(i.value,s=>(g(),p("button",{key:s,class:b({active:e.value===s}),onClick:d=>e.value=s},u(s),11,W))),128))]),r[0]||(r[0]=n("div",{class:"tab-content"},null,-1))]))}},Y=S(X,[["__scopeId","data-v-8bda7552"]]),ee={props:{type:String,progress:Number,currentTime:Number,duration:Number,isZoomed:Boolean},methods:{formatTime(o){const e=new Date(0);return e.setSeconds(o||0),e.toISOString().slice(11,19)}}},se={class:"video-controls"},oe=["value"],te={class:"time-display"};function ne(o,e,i,m,r,s){var d;return g(),p("div",se,[n("button",{onClick:e[0]||(e[0]=t=>o.$emit("toggle-play"))},u((d=o.$parent.$refs[`${i.type}Video`])!=null&&d.paused?"▶":"⏸"),1),n("input",{type:"range",class:"progress-bar",value:i.progress,onInput:e[1]||(e[1]=t=>o.$emit("seek",t.target.value)),min:"0",max:"100",step:"0.1"},null,40,oe),n("span",te,u(s.formatTime(i.currentTime))+" / "+u(s.formatTime(i.duration)),1),n("button",{onClick:e[2]||(e[2]=t=>o.$emit("toggle-zoom"))},u(i.isZoomed?"✕":"⛶"),1)])}const ie=S(ee,[["render",ne],["__scopeId","data-v-092d2f97"]]),re={components:{VideoControls:ie},props:{originalSrc:String,processedSrc:String},data(){return{isSyncing:!1,progress:{original:0,processed:0},currentTime:{original:0,processed:0},duration:{original:0,processed:0},isZoomed:{original:!1,processed:!1}}},mounted(){document.addEventListener("fullscreenchange",this.handleFullscreenChange)},beforeDestroy(){document.removeEventListener("fullscreenchange",this.handleFullscreenChange)},methods:{togglePlay(o){const e=this.$refs[`${o}Video`];e.paused?e.play():e.pause()},updateProgress(o,e){const i=o.target;this.currentTime[e]=i.currentTime,this.duration[e]=i.duration,this.progress[e]=i.currentTime/i.duration*100||0,this.isSyncing&&e==="original"&&(this.$refs.processedVideo.currentTime=i.currentTime)},handleSeek(o,e){const i=this.$refs[`${e}Video`];i.currentTime=o*i.duration/100},toggleSync(){this.isSyncing=!this.isSyncing,this.isSyncing&&this.syncVideos()},async syncVideos(){await Promise.all([this.$refs.originalVideo.play(),this.$refs.processedVideo.play()])},handlePlay(){this.isSyncing&&this.syncVideos()},handlePause(){this.isSyncing&&(this.$refs.originalVideo.pause(),this.$refs.processedVideo.pause())},async toggleZoom(o){const e=this.$refs[`${o}Panel`];this.isZoomed[o]?(await this.exitFullscreen(),this.isZoomed={...this.isZoomed,[o]:!1}):(await this.enterFullscreen(e),this.isZoomed={...this.isZoomed,[o]:!0})},async enterFullscreen(o){if(o.requestFullscreen)return o.requestFullscreen();if(o.webkitRequestFullscreen)return o.webkitRequestFullscreen();if(o.msRequestFullscreen)return o.msRequestFullscreen();console.warn("Fullscreen API is not supported")},async exitFullscreen(){document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.msExitFullscreen&&await document.msExitFullscreen()},handleFullscreenChange(){document.fullscreenElement||(this.isZoomed={original:!1,processed:!1})}}},ae={class:"video-comparator"},le={class:"global-controls"},de={class:"comparison-container"},ce={class:"video-wrapper"},ue={class:"video-frame"},me=["src"],ve={class:"video-wrapper"},ge={class:"video-frame"},pe=["src"];function fe(o,e,i,m,r,s){const d=A("video-controls");return g(),p("div",ae,[n("div",le,[e[13]||(e[13]=n("h2",null,"视频分析（原视频 / 处理视频）",-1)),n("button",{class:"sync-button",onClick:e[0]||(e[0]=(...t)=>s.toggleSync&&s.toggleSync(...t))},u(r.isSyncing?"断开同步":"同步播放"),1)]),n("div",de,[n("div",{class:b(["video-panel",{"fullscreen-mode":r.isZoomed.original}]),ref:"originalPanel"},[n("div",ce,[n("div",ue,[n("video",{ref:"originalVideo",src:i.originalSrc,onPlay:e[1]||(e[1]=t=>s.handlePlay("original")),onPause:e[2]||(e[2]=t=>s.handlePause("original")),onTimeupdate:e[3]||(e[3]=t=>s.updateProgress(t,"original"))},null,40,me)]),F(d,{type:"original",progress:r.progress.original,currentTime:r.currentTime.original,duration:r.duration.original,"is-zoomed":r.isZoomed.original,onTogglePlay:e[4]||(e[4]=t=>s.togglePlay("original")),onSeek:e[5]||(e[5]=t=>s.handleSeek(t,"original")),onToggleZoom:e[6]||(e[6]=t=>s.toggleZoom("original"))},null,8,["progress","currentTime","duration","is-zoomed"])])],2),n("div",{class:b(["video-panel",{"fullscreen-mode":r.isZoomed.processed}]),ref:"processedPanel"},[n("div",ve,[n("div",ge,[n("video",{ref:"processedVideo",src:i.processedSrc,onPlay:e[7]||(e[7]=t=>s.handlePlay("processed")),onPause:e[8]||(e[8]=t=>s.handlePause("processed")),onTimeupdate:e[9]||(e[9]=t=>s.updateProgress(t,"processed"))},null,40,pe)]),F(d,{type:"processed",progress:r.progress.processed,currentTime:r.currentTime.processed,duration:r.duration.processed,"is-zoomed":r.isZoomed.processed,onTogglePlay:e[10]||(e[10]=t=>s.togglePlay("processed")),onSeek:e[11]||(e[11]=t=>s.handleSeek(t,"processed")),onToggleZoom:e[12]||(e[12]=t=>s.toggleZoom("processed"))},null,8,["progress","currentTime","duration","is-zoomed"])])],2)])])}const he=S(re,[["render",fe],["__scopeId","data-v-d26020d3"]]),_e={class:"analysis-container"},ye={class:"section-title"},Se={class:"content-wrapper"},$e={key:0,class:"loading"},Te={key:1,class:"error"},ke={__name:"Analysis",setup(o){const e=q(),i=w(),m=v(""),r=v(""),s=v(!1),d=v(null),t=v(null),h=y(()=>e.historyItems.find(a=>a.id===e.currentAnalysisId)),P=y(()=>h.value?new Date(h.value.time).toLocaleString():""),_=async a=>{var l,c;try{s.value=!0;const $=i.token,f=await E.get(`/api/video/${a}`,{headers:{Authorization:`Bearer ${$}`}});f.data.success&&(m.value=f.data.data.original,r.value=f.data.data.processed||"")}catch($){d.value=((c=(l=$.response)==null?void 0:l.data)==null?void 0:c.message)||"获取视频地址失败"}finally{s.value=!1}};return T(()=>{var a;return(a=h.value)==null?void 0:a.video_id},a=>{a&&_(a)},{immediate:!0}),T(()=>e.currentAnalysisId,a=>{const l=e.historyItems.find(c=>c.id===a);t.value=(l==null?void 0:l.video_id)||null},{immediate:!0}),T(t,a=>{a&&_(a)}),(a,l)=>{var c;return g(),p("div",_e,[n("h2",ye,"分析汇总界面 - "+u(P.value),1),n("div",Se,[s.value?(g(),p("div",$e,"加载中...")):k("",!0),d.value?(g(),p("div",Te,u(d.value),1)):k("",!0),F(he,{"original-src":m.value,"processed-src":r.value},null,8,["original-src","processed-src"]),(c=h.value)!=null&&c.video_id&&!s.value?(g(),B(J,{key:2,"video-id":h.value.video_id},null,8,["video-id"])):k("",!0),F(Y)])])}}},Ve=S(ke,[["__scopeId","data-v-5fe9e054"]]);export{Ve as default};
